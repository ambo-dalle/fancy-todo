<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Todo</title>
  <link rel='stylesheet prefetch' href='https://www.google.com/fonts#UsePlace:use/Collection:Roboto:400,300,100,500'>
  <link rel='stylesheet prefetch' href='http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css'>
  <link rel='stylesheet prefetch' href='https://www.google.com/fonts#UsePlace:use/Collection:Roboto+Slab:400,700,300,100'>
  <script src="https://unpkg.com/vue"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>



</head>

<body>

  <div id="app">

    <!-- Navigation -->
    <nav class="navbar navbar-light  navbar-fixed-top" style="background-color: #d62d20; color:white; font-size:22px" role="navigation">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
        <a class="navbar-brand" href="#">{{username}}</a>
      </div>
      <!-- Sidebar Menu Items - These collapse to the responsive navigation menu on small screens -->
      <div class="collapse navbar-collapse navbar-ex1-collapse">
        <ul class="nav navbar-nav side-nav">
          <li class="active" >
            <a href="/"><i class="fa fa-fw fa-dashboard" ></i>Home</a>
          </li>
          <!-- <li>
            <a href="/profile.html"><i class="fa fa-fw fa-table"></i>Profile</a>
          </li> -->
          <li>
            <a @click="logout()" ><i class="fa fa-fw fa-edit"></i>Logout</a>
            <!-- <input type="button" value="Logout" onclick="Logout();" style="padding-top:10px; padding-left:0px" /> -->
          </li>
          <!-- <li>
            <a onclick="Logout()" :logout="logout"><i class="fa fa-fw fa-edit"></i>Logout FB</a>
          </li> -->

        </ul>
      </div>
      <!-- /.navbar-collapse -->
    </nav>

    <div id="page-wrapper">

      <div class="container">

        <!-- Page Heading -->

        <div class="row">
             <br>
             <br>
          <!-- <h1 class="page-header">Todo</h1> -->
          <h2>VueJs Todolist Aplication</h2>
          <div class="" class="col-sm-10 col-sm-offset-1" >

          <div class="panel panel-primary" style="background-color: #e3f2fd;">
               <div class="panel-heading">
                    <h3 class="text-center">Admin Panel</h3>
               </div>
            <div class="panel-body">
                 <div class="col-sm-4">
                      <label for="">Display Task Complete</label>
                      <input type="checkbox"><br>
                      <!-- <label for="">Display Add New Task</label>
                      <input type="checkbox"><br>
                      <label for="">Display Task Stats</label>
                      <input type="checkbox"><br> -->
                 </div>
                 <div class="col-sm-4">
                      <label for="">Display Task Uncomplete</label>
                      <input type="checkbox"><br>
                      <!-- <label for="">Display Task Completion Bar</label>
                      <input type="checkbox"><br> -->
                 </div>
                 <div class="col-sm-4">
                      <label for="">Change App Title</label>
                      <input type="text"><br>
                 </div>
            </div>
          </div>
          <!-- panel preview -->

          <div class="panel panel-info">
               <div class="panel-heading">
                    <h3 class="text-center">Todo Task List App</h3>
               </div>
          </div>
          <div class="col-sm-4">
               <div class="panel panel-info">
                    <div class="panel-heading">
                         <h3 class="text-center">Add New Todo</h3>
                    </div>
               </div>
            <div class="panel panel-primary" style="background-color: #e3f2fd;">
              <div class="panel-body form-horizontal payment-form">
                <div class="form-group">
                  <label for="concept" class="col-sm-3 control-label">Title</label>
                  <div class="col-sm-9">
                    <input v-model="title" type="text" class="form-control" id="concept" name="concept">
                  </div>
                </div>
                <div class="form-group">
                  <label for="description" class="col-sm-3 control-label">Description</label>
                  <div class="col-sm-9">
                    <input v-model="description" type="textarea" class="form-control" id="description" name="description" maxlength="140" rows="7">
                  </div>
                </div>
                <div class="form-group">
                  <label for="status" class="col-sm-3 control-label">Status</label>
                  <div class="col-sm-9">
                    <select v-model="status" class="form-control" id="status" name="status">
                                <option value="true">Completed</option>
                                <option value="false">Uncompleted</option>
                            </select>
                  </div>
                </div>
                <div class="form-group">
                  <label for="date" class="col-sm-3 control-label">Date</label>
                  <div class="col-sm-9">
                    <input v-model="dateTodo" type="date" class="form-control" id="date" name="date">
                  </div>
                </div>
                <div class="form-group">
                  <label for="date" class="col-sm-3 control-label">Time</label>
                  <div class="col-sm-9">
                    <input v-model="timeTodo" class="form-control" name="time" id="time" type="time">
                  </div>
                </div>
                <div class="form-group">
                  <div class="col-sm-12 text-right">
                    <a v-on:click="insertTodo" class="btn btn-default preview-add-button">
                      <span class="glyphicon glyphicon-plus"></span> Add Todo
                    </a>
                    <!-- <a v-on:click="updateData()" class="btn btn-default preview-add-button">
                      <span class="glyphicon glyphicon-save"></span> Save
                    </a> -->
                  </div>
                </div>
              </div>
              </div>
          </div>
          <!-- / panel preview -->

          <div class="col-sm-8">
               <div class="panel panel-info">
                    <div class="panel-heading">
                         <h3 class="text-center">List Todo</h3>
                    </div>
               </div>

            <div class="row">
              <div class="col-xs-12">
                <div class="table-responsive" style="background-color: #e3f2fd;">
                     <!-- <h2>{{ listdata }}</h2> -->
                  <table class="table table-striped ">
                    <thead>
                      <tr>
                        <th>Title</th>
                        <th>Description</th>
                        <th>Status</th>
                        <th>Date</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                    <tr v-for="todo in listdata">
                      <td>{{ todo.title }}</td>
                      <td>{{todo.description}}</td>
                      <td v-if="todo.status">Complete</td>
                      <td v-else="todo.status">UnComplete</td>
                      <td>{{ todo.date }}</td>
                      <td><a v-on:click="editTodo(todo._id)" class="btn btn-warning">Edit</a></td>
                      <td><a v-on:click="deleteTodo(todo._id)" class="btn btn-danger">Delete</a></td>

                    </tr>
                    <!-- preview content goes here-->
                  </table>
                </div>
              </div>
            </div>

          </div>


         </div>  <!-- Panel -->



        </div>

        <!-- /.row -->
      </div>

      <!-- /.container-fluid -->

    </div>
    <!-- /#page-wrapper -->

  </div>
  <!-- /#app -->



  <!-- jQuery -->
  <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>



  <script>

    new Vue({
      el: '#app',
     //  props : "logout",
      data: {
        fullname: '',
        username: '',
        title: '',
        description: '',
        status: '',
        dateTodo: '',
        timeTodo: '',
        todoId: '',
        iduser: '',
        task : '',
        listdata: []
   },
   methods : {
        getAllTodo() {
             var self = this
             axios.get('http://localhost:3000/api/todos', {
                  headers : {
                       token : localStorage.getItem('token')
                  }
             })
             .then((response)=>{
                  console.log(response);
                  self.listdata = response.data
             })
             .catch((err) => {
                  console.log(err);
             })
        },
        insertTodo() {
             var self = this
             var date = self.dateTodo + "T" + self.timeTodo + "Z";
             axios.post('http://localhost:3000/api/todos', {
                  title : self.title,
                  description : self.description,
                  status : self.status,
                  date : date,
                  id : self.iduser
             }, {
                  headers : {
                       token : localStorage.getItem('token')
                  }
             })
             .then(function(response) {
                  self.listdata.push(response.data)
                  console.log(response);
                  location.reload()
             })
             .catch((err) => {
                  console.log(err);
             })
        },

        editTodo(id) {
          var self = this
          var index = self.listdata.findIndex(lists =>lists._id == id)
          self.listdata[index].isCompleted = true
          axios.put(`http://localhost:3000/api/todos/$id`,{}, {
               headers:{token:localStorage.getItem('token')}
          })
          .then(response =>{
               self.message = response.data.msg
               self.msgStatus = true
          })
          .catch((err) => {
               console.log(err);
          })
        },


        deleteTodo(id) {
             var self = this
             var index = this.listdata.findIndex(lists => lists._id == id)
             self.listdata.splice(index,1)
             axios.delete(`http://localhost:3000/api/todos/${id}`, {
                  headers : {
                       token : localStorage.getItem('token')
                  }
             })
             .then(response =>{
                  self.msgStatus = true
                  self.message = response.data.msg
             })
             .catch((err) => {
                  console.log(err);
             })
        },

        logout() {
             localStorage.removeItem('token')
             localStorage.removeItem('data')
             window.location.href = 'login.html'
        },
        validation() {
             var self = this
             axios.get('http://localhost:3000/api/users/validation', {
                  headers : {token : localStorage.getItem('token')}
             })
             .then(response =>{
                  if(response.data.message) {
                       localStorage.clear()
                       window.location.href = "./login.html"
                  } else {
                       self.name = response.data.name.toUpperCase()
                       self.email = response.data.email.toUpperCase()
                  }
             })
             .catch((err) => {
                  console.log(err);
             })
        }
   },

   created() {
        this.getAllTodo();
        this.validation();
   }


    })
  </script>
</body>

</html>
